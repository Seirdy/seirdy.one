{{- $pages := (where site.RegularPages "Section" .Section) -}}
{{- $period := "daily" -}}
{{- $title := .Section | humanize -}}
{{- if .IsHome -}}
	{{- $title = "All content" -}}
	{{- $pages = where .Site.RegularPages "Date" "!=" (time "0001-01-01") -}}
	{{- $period = "hourly" -}}
{{- end -}}
{{- if eq .Section "notes" -}}
	{{- $period = "hourly" -}}
{{- end -}}
{{- $icon := resources.Get "/favicon.svg" | resources.Fingerprint "md5" -}}
{{- $logo := resources.Get "/atom.svg" | resources.Fingerprint "md5" -}}
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<feed
	xmlns="http://www.w3.org/2005/Atom"
	xmlns:activity="http://activitystrea.ms/spec/1.0/"
	xmlns:media="http://search.yahoo.com/mrss/"
	xmlns:ostatus="http://ostatus.org/schema/1.0"
	xmlns:poco="http://portablecontacts.net/spec/1.0"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:thr="http://purl.org/syndication/thread/1.0"
	xml:lang="{{ .Site.LanguageCode }}">
	<title>{{ $title }} on {{ .Site.Title }}</title>
	<subtitle>
		{{- if .Params.Description -}}
			{{- .Params.Description -}}
		{{- else -}}
			{{- .Site.Params.Description -}}
		{{- end -}}
	</subtitle>
	<icon>{{ $icon.Permalink }}</icon><logo>{{ $logo.Permalink }}</logo>
	<link rel="self" type="application/atom+xml" href="{{ .Permalink }}atom.xml" />
	<sy:updatePeriod>{{ $period }}</sy:updatePeriod>
	<sy:updateFrequency>2</sy:updateFrequency>
  <author>
		<activity:object-type>http://activitystrea.ms/schema/1.0/person</activity:object-type>
		<poco:preferredUsername>Seirdy</poco:preferredUsername>
		<poco:displayName>Seirdy</poco:displayName>
    <name>Seirdy</name>
		<uri>https://seirdy.one/</uri>
  </author>
  <updated>{{ now.Format "2006-01-02T15:04:05-07:00" | safeHTML }}</updated>
  <id>{{ .Permalink }}</id>
  {{ range $pages -}}
	{{- if not .Params.Private -}}
  <entry>
		<title>{{ .Title }}</title>
		<link rel="alternate" type="text/html" href="{{ .Permalink }}" /><id>{{ .Permalink }}</id>
		<published>{{ .Date.Format "2006-01-02T15:04:05-07:00" | safeHTML }}</published><updated>{{ .Lastmod.Format "2006-01-02T15:04:05-07:00" | safeHTML }}</updated>
		<author><name>Seirdy</name><uri>https://seirdy.one/</uri></author>
		<rights>CC-BY-SA 4.0</rights>
		{{- with .Params.replyURI -}}
		<thr:in-reply-to ref="{{ . }}" href="{{ . }}" />
		{{- end -}}
		{{- with .Params.replyAuthorURI -}}
		<link rel="mentioned" ostatus:object-type="http://activitystrea.ms/schema/1.0/person" href="{{ . }}"/>
		{{- end -}}
		{{- $type := "article" -}}
		{{- if eq .Section "notes" -}}
			{{- $type = "note" -}}
		{{- end -}}
		<activity:object-type>http://activitystrea.ms/schema/1.0/{{ $type }}</activity:object-type>
		<activity:verb>http://activitystrea.ms/schema/1.0/post</activity:verb>
		{{- with .Params.image -}}
		{{- $image := resources.Get (printf "/p/%s" . ) | resources.Fingerprint "md5" -}}
		<media:thumbnail url="{{ $image.Permalink }}" width="{{ $image.Width }}" height="{{ $image.Height }}" />
		{{- end -}}
		<content type="xhtml" xml:base="{{ .Permalink }}">
			<div xmlns="http://www.w3.org/1999/xhtml">
					{{- if .Params.replyURI -}}
						{{- partial "reply-context" .Params | replaceRE `(?: )?(?:item(type|scope|prop|id|ref)="[^"]*"|class="language-figure")` "" | safeHTML }}
					{{- end -}}
					{{ partial "processed-content.html" . | replaceRE `(?: )?(?:item(type|scope|prop|id|ref)="[^"]*"|class="language-figure")` "" | replaceRE `<meta content="true" ?/>` "" | safeHTML -}}
			</div>
		</content>
	</entry>
  {{ end -}}
	{{- end }}
</feed>
